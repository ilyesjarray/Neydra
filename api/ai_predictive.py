import yfinance as yf, pandas as pd, numpy as np, pymysql, json, sys, os;from datetime import datetime;conn=pymysql.connect(host=os.getenv('DB_HOST'),user=os.getenv('DB_USER'),passwd=os.getenv('DB_PASS'),db=os.getenv('DB_NAME'));data=yf.download("GC=F",period="1mo",interval="1h");data['SMA_20']=data['Close'].rolling(window=20).mean();data['RSI']=100-(100/(1+data['Close'].diff().apply(lambda x: x if x>0 else 0).rolling(14).mean()/data['Close'].diff().apply(lambda x: abs(x) if x<0 else 0).rolling(14).mean()));last_price=data['Close'].iloc[-1];last_rsi=data['RSI'].iloc[-1];signal='BUY' if last_rsi<30 else 'SELL' if last_rsi>70 else 'HOLD';cursor=conn.cursor();cursor.execute("INSERT INTO predictions_cache (asset, signal, confidence, price) VALUES (%s, %s, %s, %s)",("XAU/USD",signal,float(abs(50-last_rsi)),float(last_price)));conn.commit();print(json.dumps({"signal":signal,"price":float(last_price),"rsi":float(last_rsi),"timestamp":str(datetime.now())}));conn.close();
