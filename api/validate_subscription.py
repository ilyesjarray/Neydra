const mysql = require('mysql2/promise');module.exports = async (req, res) => {const connection = await mysql.createConnection(process.env.DATABASE_URL);const userEmail = req.headers['x-user-email'] || 'guest';try{const [rows] = await connection.execute('SELECT subscription_plan, expires_at FROM users WHERE email = ?', [userEmail]);if(rows.length === 0){res.json({plan: 'free'});}else{const plan = rows[0].subscription_plan;const expiry = new Date(rows[0].expires_at);const now = new Date();if(now < expiry){res.json({plan: plan});}else{res.json({plan: 'free'});}}}catch(e){res.status(500).json({error: e.message});}finally{await connection.end();}};
